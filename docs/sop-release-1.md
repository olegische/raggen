# SOP: Release 1.0 - Интеграция RAG

## 1. Подготовка инфраструктуры

### 1.1. Настройка монорепозитория
- [x] Создать базовую структуру монорепозитория
- [x] Настроить .gitignore для обоих сервисов
- [ ] Настроить линтеры и форматтеры
- [x] Создать базовые README файлы

### 1.2. Настройка raggen-web
- [ ] Инициализировать Next.js проект
- [ ] Настроить TypeScript
- [ ] Настроить Tailwind CSS
- [ ] Настроить Prisma
- [ ] Создать базовую структуру директорий

### 1.3. Настройка raggen-embed
- [x] Создать Python проект с FastAPI
- [x] Настроить виртуальное окружение
- [x] Установить sentence-transformers и FAISS
- [x] Создать базовую структуру директорий
- [x] Настроить конфигурацию проекта

## 2. Разработка raggen-embed

### 2.1. Базовая структура
- [x] Создать основной FastAPI application
- [x] Настроить CORS для взаимодействия с raggen-web
- [x] Настроить логирование
- [x] Добавить конфигурацию через environment variables

### 2.2. Модель эмбеддингов
- [x] Интегрировать модель all-MiniLM-L6-v2
- [x] Создать сервис для работы с моделью
- [x] Реализовать кэширование модели
- [x] Добавить обработку ошибок модели

### 2.3. Векторное хранилище
- [x] Настроить FAISS для 384-мерных векторов
- [x] Реализовать сохранение векторов
- [x] Реализовать поиск похожих векторов
- [ ] Добавить персистентность индекса FAISS

### 2.4. API Endpoints
- [x] Создать endpoint для векторизации текста
- [x] Создать endpoint для поиска похожих текстов
- [x] Добавить валидацию входных данных
- [x] Реализовать обработку ошибок

### 2.5. Тестирование
- [x] Написать unit тесты для сервисов
- [x] Написать интеграционные тесты для API
- [ ] Добавить тесты производительности
- [ ] Настроить CI для тестов

## 3. Обновление raggen-web

### 3.1. База данных
- [x] Обновить схему Prisma для хранения контекста
- [x] Создать миграции
- [x] Добавить индексы для оптимизации
- [x] Реализовать сервисный слой для работы с БД

### 3.2. Интеграция с raggen-embed
- [ ] Создать клиент для raggen-embed API
- [ ] Реализовать сервис для работы с эмбеддингами
- [ ] Добавить обработку ошибок
- [ ] Реализовать retry механизм

### 3.3. Обработка контекста
- [ ] Реализовать сервис поиска контекста
- [ ] Создать форматтер промптов с контекстом
- [ ] Добавить приоритизацию контекста
- [ ] Реализовать кэширование контекста

### 3.4. UI компоненты
- [ ] Добавить индикацию использованного контекста
- [ ] Обновить компонент чата
- [ ] Добавить настройки контекста
- [ ] Реализовать отображение истории с контекстом

### 3.5. Тестирование
- [ ] Написать unit тесты для новых сервисов
- [ ] Обновить тесты компонентов
- [ ] Добавить интеграционные тесты
- [ ] Протестировать производительность

## 4. Интеграция и тестирование

### 4.1. Локальное тестирование
- [ ] Настроить локальное окружение для обоих сервисов
- [ ] Протестировать взаимодействие сервисов
- [ ] Проверить обработку ошибок
- [ ] Замерить производительность

### 4.2. Нагрузочное тестирование
- [ ] Протестировать векторизацию под нагрузкой
- [ ] Проверить производительность поиска
- [ ] Оценить потребление памяти FAISS
- [ ] Оптимизировать узкие места

### 4.3. Интеграционное тестирование
- [ ] Проверить работу с разными провайдерами
- [ ] Протестировать различные сценарии использования
- [ ] Проверить обработку edge cases
- [ ] Валидировать качество контекста

## 5. Документация

### 5.1. Техническая документация
- [ ] Описать API endpoints
- [ ] Документировать схему базы данных
- [ ] Описать конфигурацию сервисов
- [ ] Добавить примеры использования

### 5.2. Документация по развертыванию
- [ ] Создать инструкции по установке
- [ ] Описать конфигурацию окружения
- [ ] Добавить примеры конфигурационных файлов
- [ ] Описать процедуры отката

### 5.3. Пользовательская документация
- [ ] Описать работу с контекстом
- [ ] Добавить примеры использования
- [ ] Описать настройки и конфигурацию
- [ ] Добавить FAQ

## 6. Развертывание

### 6.1. Подготовка
- [ ] Проверить все зависимости
- [ ] Подготовить конфигурационные файлы
- [ ] Прове��ить доступы к API провайдеров
- [ ] Подготовить скрипты развертывания

### 6.2. Развертывание сервисов
- [ ] Развернуть raggen-embed
- [ ] Развернуть raggen-web
- [ ] Настроить взаимодействие между сервисами
- [ ] Проверить логирование

### 6.3. Пост-развертывание
- [ ] Проверить все функции в production
- [ ] Мониторить производительность
- [ ] Проверить обработку ошибок
- [ ] Валидировать качество ответов

## 7. Критерии приемки

### 7.1. Функциональные требования
- [ ] Векторизация сообщений работает корректно
- [ ] Поиск контекста возвращает релевантные результаты
- [ ] Промпты формируются с учетом контекста
- [ ] UI корректно отображает использованный контекст

### 7.2. Нефункциональные требования
- [ ] Время ответа API не превышает 500мс
- [ ] Потребление памяти FAISS в пределах нормы
- [ ] Все тесты проходят успешно
- [ ] Документация полная и актуальная