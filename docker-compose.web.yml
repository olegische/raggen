version: '3.3'

services:
  raggen-web:
    image: cr.yandex/${REGISTRY_ID}/raggen-web:${VERSION}
    ports:
      - "3000:3000"
    volumes:
      # Монтируем .env файл напрямую в контейнер
      - /opt/raggen/raggen-web/.env:/app/.env
      # Монтируем всю директорию prisma для сохранения миграций и схемы
      - /opt/raggen/data/sqlite/prisma:/app/prisma
    environment:
      - DATABASE_URL=file:/app/prisma/dev.db
      # URL для продакшена должен указывать на внешний адрес сервиса эмбеддингов
      - NEXT_PUBLIC_EMBED_API_URL=http://embed.your-domain.com:8001
    restart: unless-stopped

volumes:
  sqlite-data:
    driver: local
